.NET 10 (ASP.NET Core Web API)

React 19 (Vite –∞–±–æ CRA ‚Äî –Ω–µ –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤–æ)

Docker Hub: pedro007salo

–æ–¥–∏–Ω docker-compose.yml –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ

1. –¶—ñ–ª—å–æ–≤–∞ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ (—è–∫ —Ü–µ –±—É–¥–µ –≤–∏–≥–ª—è–¥–∞—Ç–∏)
Internet
   |
   |-- :80 / :443
   |
[ Nginx (React static) ]
           |
           | fetch /api/*
           v
[ ASP.NET Core API (.NET 10) ]
           |
           v
[ PostgreSQL ]

2. –§—ñ–Ω–∞–ª—å–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é
CounterWatch
‚îÇ
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ build_and_push.bat
‚îÇ
‚îú‚îÄ‚îÄ CounterWatchApi
‚îÇ   ‚îú‚îÄ‚îÄ CounterWatchApi
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CounterWatchApi.csproj
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Program.cs
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ   ‚îî‚îÄ‚îÄ Dockerfile
‚îÇ
‚îî‚îÄ‚îÄ CounterWatchSite
    ‚îî‚îÄ‚îÄ movie-web
        ‚îú‚îÄ‚îÄ src
        ‚îú‚îÄ‚îÄ index.html
        ‚îú‚îÄ‚îÄ package.json
        ‚îú‚îÄ‚îÄ nginx.conf
        ‚îî‚îÄ‚îÄ Dockerfile

3. Dockerfile –¥–ª—è API (.NET 10)

üìç CounterWatchApi/Dockerfile

# ===== BUILD =====
FROM mcr.microsoft.com/dotnet/sdk:10.0-preview AS build
WORKDIR /src

COPY CounterWatchApi/CounterWatchApi.csproj CounterWatchApi/
RUN dotnet restore CounterWatchApi/CounterWatchApi.csproj

COPY . .
WORKDIR /src/CounterWatchApi
RUN dotnet publish -c Release -o /app/publish

# ===== RUNTIME =====
FROM mcr.microsoft.com/dotnet/aspnet:10.0-preview
WORKDIR /app

EXPOSE 8080

COPY --from=build /app/publish .

ENTRYPOINT ["dotnet", "CounterWatchApi.dll"]

–í–∞–∂–ª–∏–≤–æ

API –ø—Ä–∞—Ü—é—î –Ω–∞ 8080 —É—Å–µ—Ä–µ–¥–∏–Ω—ñ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

–ó–æ–≤–Ω—ñ—à–Ω—ñ–π –ø–æ—Ä—Ç –Ω–∞–ª–∞—à—Ç—É—î–º–æ –≤ compose

4. Dockerfile –¥–ª—è React 19

üìç CounterWatchSite/movie-web/Dockerfile

# ===== BUILD =====
FROM node:20-alpine AS build
WORKDIR /app

COPY package*.json ./
RUN npm install

COPY . .
RUN npm run build

# ===== NGINX =====
FROM nginx:alpine

RUN rm /etc/nginx/conf.d/default.conf
COPY nginx.conf /etc/nginx/conf.d/default.conf

COPY --from=build /app/dist /usr/share/nginx/html

EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]

5. nginx.conf –¥–ª—è React (proxy –Ω–∞ API)

üìç CounterWatchSite/movie-web/nginx.conf

server {
    listen 80;
    server_name _;

    root /usr/share/nginx/html;
    index index.html;

    location / {
        try_files $uri /index.html;
    }

    location /api/ {
        proxy_pass http://api:8080/;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}

6. docker-compose.yml (–≥–æ–ª–æ–≤–Ω–∏–π —Ñ–∞–π–ª)

üìç CounterWatch/docker-compose.yml

version: "3.9"

networks:
  counterwatch_net:
    driver: bridge

services:
  db:
    image: postgres:17
    container_name: counterwatch-db
    restart: unless-stopped
    environment:
      POSTGRES_DB: counterwatch
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
    volumes:
      - /data/counterwatch/postgres:/var/lib/postgresql/data
    networks:
      - counterwatch_net

  api:
    image: pedro007salo/counterwatch-api:latest
    container_name: counterwatch-api
    restart: unless-stopped
    environment:
      ASPNETCORE_ENVIRONMENT: Production
      ConnectionStrings__DefaultConnection: Host=db;Database=counterwatch;Username=postgres;Password=postgres
    depends_on:
      - db
    networks:
      - counterwatch_net

  web:
    image: pedro007salo/counterwatch-web:latest
    container_name: counterwatch-web
    restart: unless-stopped
    ports:
      - "80:80"
    depends_on:
      - api
    networks:
      - counterwatch_net

7. build_and_push.bat (–ª–æ–∫–∞–ª—å–Ω–æ)
@echo off

REM ==== WEB ====
cd CounterWatchSite\movie-web
docker build -t counterwatch-web .
docker tag counterwatch-web:latest pedro007salo/counterwatch-web:latest
docker push pedro007salo/counterwatch-web:latest

REM ==== API ====
cd ..\..\CounterWatchApi
docker build -t counterwatch-api .
docker tag counterwatch-api:latest pedro007salo/counterwatch-api:latest
docker push pedro007salo/counterwatch-api:latest

echo DONE
pause

8. –î–µ–ø–ª–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ (–∑ –Ω—É–ª—è)
# 1. –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ Docker
curl -fsSL https://get.docker.com | sh

# 2. –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ docker-compose
sudo apt install docker-compose -y

# 3. –°—Ç–≤–æ—Ä–∏—Ç–∏ –ø–∞–ø–∫—É
mkdir CounterWatch
cd CounterWatch

# 4. –°–∫–æ–ø—ñ—é–≤–∞—Ç–∏ docker-compose.yml
# 5. –ó–∞–ø—É—Å—Ç–∏—Ç–∏
docker-compose pull
docker-compose up -d

–°—Ç–µ—Ä—Ç–∏ –∫–µ—à

docker-compose down --volumes --rmi all
docker system prune -af
docker-compose up -d
